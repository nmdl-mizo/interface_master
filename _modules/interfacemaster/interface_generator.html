

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>interfacemaster.interface_generator &#8212; interfacemaster 1.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/interfacemaster/interface_generator';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">interfacemaster 1.1 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../interfacemaster.html">
                        API Reference
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="http://www.edge.iis.u-tokyo.ac.jp/">
                    Nano-Materials Design Lab.
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/nmdl-mizo/interface_master" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../interfacemaster.html">
                        API Reference
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="http://www.edge.iis.u-tokyo.ac.jp/">
                    Nano-Materials Design Lab.
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/nmdl-mizo/interface_master" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">interfacemaster.interface_generator</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for interfacemaster.interface_generator</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">interface_generator.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">inv</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cross</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">column_stack</span><span class="p">,</span> <span class="n">eye</span><span class="p">,</span> <span class="n">arccos</span><span class="p">,</span> <span class="n">around</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">interfacemaster.cellcalc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MID</span><span class="p">,</span> <span class="n">DSCcalc</span><span class="p">,</span> <span class="n">get_primitive_hkl</span><span class="p">,</span> <span class="n">get_right_hand</span><span class="p">,</span> <span class="n">get_pri_vec_inplane</span><span class="p">,</span>
    <span class="n">get_ortho_two_v</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">get_normal_from_MI</span><span class="p">)</span>

<div class="viewcode-block" id="get_disorientation"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_disorientation">[docs]</a><span class="k">def</span> <span class="nf">get_disorientation</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">hkl1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">hkl2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    produce a rotation matrix</span>
<span class="sd">    so that the hkl1 plane overlap with the hkl2 plane and the v1 colinear with v2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    L1, L2 : numpy array</span>
<span class="sd">        lattice basis sets</span>
<span class="sd">    v1, v2 : numpy array</span>
<span class="sd">        vectors</span>
<span class="sd">    hkl1, hkl2 : numpy array</span>
<span class="sd">        Miller indices</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    rot_mat : numpy array</span>
<span class="sd">        a rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#normal vector</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">get_normal_from_MI</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">hkl1</span><span class="p">)</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">get_normal_from_MI</span><span class="p">(</span><span class="n">L2</span><span class="p">,</span> <span class="n">hkl2</span><span class="p">)</span>

    <span class="c1">#auxiliary lattice</span>
    <span class="n">Av1</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span><span class="n">v1</span><span class="p">),</span> <span class="n">n1</span><span class="p">)</span>
    <span class="n">Av2</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L2</span><span class="p">,</span><span class="n">v2</span><span class="p">),</span> <span class="n">n2</span><span class="p">)</span>

    <span class="c1">#get the auxiliary lattices</span>
    <span class="n">AL1</span> <span class="o">=</span> <span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span><span class="n">v1</span><span class="p">),</span> <span class="n">n1</span><span class="p">,</span> <span class="n">Av1</span><span class="p">))</span>
    <span class="n">AL2</span> <span class="o">=</span> <span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L2</span><span class="p">,</span><span class="n">v2</span><span class="p">),</span> <span class="n">n2</span><span class="p">,</span> <span class="n">Av2</span><span class="p">))</span>

    <span class="c1">#unit mtx</span>
    <span class="n">AL1</span> <span class="o">=</span> <span class="n">get_unit_mtx</span><span class="p">(</span><span class="n">AL1</span><span class="p">)</span>
    <span class="n">AL2</span> <span class="o">=</span> <span class="n">get_unit_mtx</span><span class="p">(</span><span class="n">AL2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">AL1</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">AL2</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_unit_mtx"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_unit_mtx">[docs]</a><span class="k">def</span> <span class="nf">get_unit_mtx</span><span class="p">(</span><span class="n">lattice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a unit lattice so that the length of every column vectors is 1</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice basis set</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice_return : numpy array</span>
<span class="sd">        basis set of a unit lattice</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lattice_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">lattice_return</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">lattice_return</span></div>

<div class="viewcode-block" id="rot"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.rot">[docs]</a><span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    produce a rotation matrix</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : numpy array</span>
<span class="sd">        rotation axis</span>
<span class="sd">    Theta: float</span>
<span class="sd">        rotation angle</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    rot_mat : numpy array</span>
<span class="sd">        a rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">c</span> <span class="o">+</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">),</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">ay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">az</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span>
                      <span class="n">ax</span> <span class="o">*</span> <span class="n">az</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">s</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">ay</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">az</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">ay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">),</span>
                        <span class="n">ay</span> <span class="o">*</span> <span class="n">az</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">s</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">az</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">az</span> <span class="o">*</span> <span class="n">ay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span>
                      <span class="n">c</span> <span class="o">+</span> <span class="n">az</span> <span class="o">*</span> <span class="n">az</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)]],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>

<div class="viewcode-block" id="rational_mtx"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.rational_mtx">[docs]</a><span class="k">def</span> <span class="nf">rational_mtx</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    find a rational matrix close to M</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    M : numpy array</span>
<span class="sd">        original matrix</span>
<span class="sd">    N : int</span>
<span class="sd">        denominator</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    B : numpy array</span>
<span class="sd">        integer matrix</span>
<span class="sd">    N : int</span>
<span class="sd">        denominator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="n">N</span></div>

<div class="viewcode-block" id="three_dot"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.three_dot">[docs]</a><span class="k">def</span> <span class="nf">three_dot</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">M3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compute the three continuous dot product</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    M1, M2, M3 : numpy array</span>
<span class="sd">        matrices</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    P : numpy array</span>
<span class="sd">        dot product</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">),</span><span class="n">M3</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_ang_list"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_ang_list">[docs]</a><span class="k">def</span> <span class="nf">get_ang_list</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a list of ang cos between one list of vecor and one vector</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m1 : numpy array</span>
<span class="sd">        list of vectors</span>
<span class="sd">    n : numpy array</span>
<span class="sd">        a vector</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    c : numpy array</span>
<span class="sd">        list of cos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="cross_plane"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.cross_plane">[docs]</a><span class="k">def</span> <span class="nf">cross_plane</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">orthogonal</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">inclination_tol</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get a primitive lattice vector cross a plane</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    n : numpy array</span>
<span class="sd">        a normal vector</span>
<span class="sd">    lim : int</span>
<span class="sd">        control how many vectors to be generated</span>
<span class="sd">    tol : float</span>
<span class="sd">        tolerance judging orthogonal</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    n_p : numpy array</span>
<span class="sd">        a primitve vector normal to the plane</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">lim</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">indice</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">indice_0</span> <span class="o">=</span> <span class="n">indice</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">indice</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">indice_0</span> <span class="o">=</span> <span class="n">indice_0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gcd</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">indice_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">ltc_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">indice_0</span><span class="p">,</span> <span class="n">lattice</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">ltc_p</span> <span class="o">=</span> <span class="n">ltc_p</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">ltc_p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))]</span>
    <span class="n">dot_list</span> <span class="o">=</span> <span class="n">get_ang_list</span><span class="p">(</span><span class="n">ltc_p</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">orthogonal</span><span class="p">:</span>
        <span class="n">normal_v</span> <span class="o">=</span> <span class="n">ltc_p</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dot_list</span> <span class="o">&gt;=</span> <span class="n">inclination_tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">normal_v</span> <span class="o">=</span> <span class="n">normal_v</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">normal_v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))]</span>
        <span class="n">normal_v</span> <span class="o">=</span> <span class="n">normal_v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">normal_v</span> <span class="o">=</span> <span class="n">ltc_p</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dot_list</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;failed to find a vector cross the plane. &#39;</span>
                <span class="s1">&#39;try larger lim or smaller tol or use non-orthogonal cell&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
    <span class="k">return</span> <span class="n">normal_v</span></div>

<div class="viewcode-block" id="get_sites_elements"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_sites_elements">[docs]</a><span class="k">def</span> <span class="nf">get_sites_elements</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the coordinates of atoms and the elements</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    structure : pymatgen structure class</span>
<span class="sd">        input structure</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of atoms in the primitive cell</span>
<span class="sd">    elements : numpy aray</span>
<span class="sd">        list of element name of the atoms</span>
<span class="sd">    return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atoms</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">species_string</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span></div>

<div class="viewcode-block" id="POSCAR_to_cif"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.POSCAR_to_cif">[docs]</a><span class="k">def</span> <span class="nf">POSCAR_to_cif</span><span class="p">(</span><span class="n">Poscar_name</span><span class="p">,</span> <span class="n">Cif_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generate a cif file for the structure in a POSCAR file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Poscar_name : str</span>
<span class="sd">        name of a POSCAR file</span>
<span class="sd">    Cif_name : str</span>
<span class="sd">        name of a cif file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">Poscar_name</span><span class="p">)</span>
    <span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">Cif_name</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">structure</span></div>

<div class="viewcode-block" id="write_LAMMPS"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.write_LAMMPS">[docs]</a><span class="k">def</span> <span class="nf">write_LAMMPS</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;lmp_atoms_file&#39;</span><span class="p">,</span> <span class="n">orthogonal</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    write LAMMPS input atom file file of a supercell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional atoms coordinates</span>
<span class="sd">    elements : numpy array</span>
<span class="sd">        list of element name of the atoms</span>
<span class="sd">    filename : str</span>
<span class="sd">        filename of LAMMPS input atom file to write, default &quot;lmp_atoms_file&quot;</span>
<span class="sd">    orthogonal : bool</span>
<span class="sd">        whether write orthogonal cell, default False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#list of elements</span>
    <span class="n">element_species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="c1">#to Cartesian</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1">#get the speicie identifiers (e.g. 1 for Cu, 2 for O...)</span>
    <span class="n">element_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element_species</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">species_identifiers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">es</span><span class="p">,</span> <span class="n">ei</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">element_species</span><span class="p">,</span> <span class="n">element_indices</span><span class="p">):</span>
        <span class="n">indices_this_element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">elements</span> <span class="o">==</span> <span class="n">es</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">species_identifiers</span><span class="p">[</span><span class="n">indices_this_element</span><span class="p">]</span> <span class="o">=</span> <span class="n">ei</span>

    <span class="n">species_identifiers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">species_identifiers</span><span class="p">])</span>

    <span class="c1">#the atom ID</span>
    <span class="n">IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1">#get the final format</span>
    <span class="n">Final_format</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">IDs</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">species_identifiers</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Final_format</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Final_format</span><span class="p">,</span> <span class="n">atoms</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1">#define the box</span>
    <span class="c1">#xlo, xhi</span>
    <span class="n">xhi</span><span class="p">,</span> <span class="n">yhi</span><span class="p">,</span> <span class="n">zhi</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">lattice</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">xlo</span><span class="p">,</span> <span class="n">ylo</span><span class="p">,</span> <span class="n">zlo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yz</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#LAMMPS input file of atoms generated by interface_master. The elements are: &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ei</span><span class="p">,</span> <span class="n">es</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">element_indices</span><span class="p">,</span> <span class="n">element_species</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ei</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">es</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span><span class="si">}</span><span class="s1"> atoms </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">element_species</span><span class="p">)</span><span class="si">}</span><span class="s1"> atom types </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xlo</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xhi</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> xlo xhi </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ylo</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">yhi</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> ylo yhi </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">zlo</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">zhi</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> zlo zhi </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">orthogonal</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xy</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xz</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">yz</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1"> xy xz yz </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Atoms </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Final_format</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%.16f</span><span class="s1"> </span><span class="si">%.16f</span><span class="s1"> </span><span class="si">%.16f</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="write_POSCAR"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.write_POSCAR">[docs]</a><span class="k">def</span> <span class="nf">write_POSCAR</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    write Poscar file of a supercell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional atoms coordinates</span>
<span class="sd">    elements : numpy array</span>
<span class="sd">        list of element name of the atoms</span>
<span class="sd">    filename : str</span>
<span class="sd">        filename of POSCAR filename to wirte, default &quot;POSCAR&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element_species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="n">atoms_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">num_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">es</span> <span class="ow">in</span> <span class="n">element_species</span><span class="p">:</span>
        <span class="n">atoms_this_element</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">elements</span> <span class="o">==</span> <span class="n">es</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">atoms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms_this_element</span><span class="p">)</span>
        <span class="n">num_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_this_element</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_species</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">atoms_list</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atoms</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#POSCAR generated by IF_master </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#matrix</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.16f</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#elements</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">element_species</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#num of atoms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_list</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Direct</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.16f</span><span class="s1"> </span><span class="si">%.16f</span><span class="s1"> </span><span class="si">%.16f</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="cell_expands"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.cell_expands">[docs]</a><span class="k">def</span> <span class="nf">cell_expands</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    expand certain supercell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        list of atom fractional coordinates</span>
<span class="sd">    elements : numpy array</span>
<span class="sd">        list of element name of the atoms</span>
<span class="sd">    xyz : list of int</span>
<span class="sd">        list of expansion factor for the x, y, z directions</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        atom coordinates</span>
<span class="sd">    elements : numpy array</span>
<span class="sd">        list of element name of the atoms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mtx</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dimX</span><span class="p">,</span> <span class="n">dimY</span><span class="p">,</span> <span class="n">dimZ</span> <span class="o">=</span> <span class="n">xyz</span>
    <span class="n">x_shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dimX</span><span class="p">)</span>
    <span class="n">y_shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dimY</span><span class="p">)</span>
    <span class="n">z_shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dimZ</span><span class="p">)</span>

    <span class="n">g1_shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_shifts</span><span class="p">,</span> <span class="n">y_shifts</span><span class="p">,</span> <span class="n">z_shifts</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">atoms_expand</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g1_shifts</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">g1_shifts</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g1_shifts</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">atoms_expand</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms_expand</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">mtx</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtx</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mtx</span><span class="p">,</span> <span class="n">atoms_expand</span><span class="p">,</span> <span class="n">elements</span></div>

<div class="viewcode-block" id="get_array_bounds"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_array_bounds">[docs]</a><span class="k">def</span> <span class="nf">get_array_bounds</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the meshgrid formed by three sets of lower &amp; upper bounds.</span>

<span class="sd">    the bounds cooresponds to the 8 vertices of the cell</span>
<span class="sd">    consisting of the three column vectors of a matrix</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    U : numpy array</span>
<span class="sd">        integer matrix</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    indice : numpy array</span>
<span class="sd">        meshgrid made by the lower and upper bounds of the indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Mo</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># get the coordinates of 8 vertices</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">Mo</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">P3</span> <span class="o">=</span> <span class="n">Mo</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">P4</span> <span class="o">=</span> <span class="n">Mo</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">P5</span> <span class="o">=</span> <span class="n">P2</span> <span class="o">+</span> <span class="n">P3</span>
    <span class="n">P6</span> <span class="o">=</span> <span class="n">P2</span> <span class="o">+</span> <span class="n">P4</span>
    <span class="n">P7</span> <span class="o">=</span> <span class="n">P3</span> <span class="o">+</span> <span class="n">P4</span>
    <span class="n">P8</span> <span class="o">=</span> <span class="n">P2</span> <span class="o">+</span> <span class="n">P3</span> <span class="o">+</span> <span class="n">P4</span>
    <span class="n">Points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">P1</span><span class="p">,</span><span class="n">P2</span><span class="p">,</span><span class="n">P3</span><span class="p">,</span><span class="n">P4</span><span class="p">,</span><span class="n">P5</span><span class="p">,</span><span class="n">P6</span><span class="p">,</span><span class="n">P7</span><span class="p">,</span><span class="n">P8</span><span class="p">))</span>
    <span class="c1"># enclose the 8 verticies</span>
    <span class="n">min1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">min2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">min3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min3</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">indice</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indice</span></div>

<div class="viewcode-block" id="super_cell"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.super_cell">[docs]</a><span class="k">def</span> <span class="nf">super_cell</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make supercell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    U : numpy array</span>
<span class="sd">        coefficients of the LC of three vectors from the basis</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of atoms</span>
<span class="sd">    elements : numpy array</span>
<span class="sd">        list of the element names of these atoms</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        atom coordinates</span>
<span class="sd">    elements : numpy array</span>
<span class="sd">        list of element name of the atoms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indice</span> <span class="o">=</span> <span class="n">get_array_bounds</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>

    <span class="c1">#1.get atoms</span>
    <span class="n">Atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indice</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">indice</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">Atoms</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indice</span><span class="p">))</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-10</span>

    <span class="c1">#3.delete atoms dropping outside</span>
    <span class="n">Atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">U</span><span class="p">),</span><span class="n">Atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Atoms_try</span> <span class="o">=</span> <span class="n">Atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="n">tol</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">tol</span><span class="p">]</span>
    <span class="n">con</span> <span class="o">=</span> <span class="p">(</span><span class="n">Atoms_try</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Atoms_try</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> \
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">Atoms_try</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Atoms_try</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> \
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">Atoms_try</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Atoms_try</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">con</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">lattice</span></div>

<div class="viewcode-block" id="shift_termi_left"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.shift_termi_left">[docs]</a><span class="k">def</span> <span class="nf">shift_termi_left</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    changing terminate involves requiring to cut or extend the cell for identical interfaces</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        a matrix with column lattice vectors</span>
<span class="sd">    dp : float</span>
<span class="sd">        height of termination shift</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of the atoms</span>
<span class="sd">    elements : list</span>
<span class="sd">        list of element names</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms, elements : tuple of numpy array and list</span>
<span class="sd">        shifted atom coordinates, corresponding list of elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">position_shift</span> <span class="o">=</span> <span class="n">dp</span> <span class="o">/</span> <span class="n">ang</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_shift</span>
    <span class="k">if</span> <span class="n">dp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="c1">#shift to origin</span>
        <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span>
        <span class="c1">#to cartesian</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#cut</span>
        <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="c1">#back</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">atoms_c_1</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">atoms_c_2</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">elements_c</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">atoms_c_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">atoms_c_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atoms</span><span class="p">,</span> <span class="n">atoms_c_1</span><span class="p">,</span> <span class="n">atoms_c_2</span><span class="p">))</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">elements_c</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">elements_c</span><span class="p">)</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="c1">#shift to origin</span>
        <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span>
        <span class="c1">#to cartesian</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#cut</span>
        <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="c1">#back</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span></div>

<div class="viewcode-block" id="shift_none_copy"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.shift_none_copy">[docs]</a><span class="k">def</span> <span class="nf">shift_none_copy</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    changing terminate involves without requiring to cut or extend the cell for identical interfaces</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        a matrix with column lattice vectors</span>
<span class="sd">    dp : foat</span>
<span class="sd">        height of termination shift</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of the atoms</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        shifted atom coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">position_shift</span> <span class="o">=</span> <span class="n">dp</span> <span class="o">/</span> <span class="n">ang</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_shift</span>
    <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">atoms</span></div>

<div class="viewcode-block" id="shift_termi_right"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.shift_termi_right">[docs]</a><span class="k">def</span> <span class="nf">shift_termi_right</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    changing terminate involves requiring to cut or extend the cell for identical interfaces</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        a matrix with column lattice vectors</span>
<span class="sd">    dp : float</span>
<span class="sd">        height of termination shift</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of the atoms</span>
<span class="sd">    elements : list</span>
<span class="sd">        list of element names</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms, elements : numpy array</span>
<span class="sd">        shifted atom coordinates, corresponding list of elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">position_shift</span> <span class="o">=</span> <span class="n">dp</span> <span class="o">/</span> <span class="n">ang</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_shift</span>
    <span class="k">if</span> <span class="n">dp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="c1">#to cartesian</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#cut</span>
        <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="c1">#back</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">atoms_c_1</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">atoms_c_2</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">elements_c</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">atoms_c_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">atoms_c_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atoms</span><span class="p">,</span> <span class="n">atoms_c_1</span><span class="p">,</span> <span class="n">atoms_c_2</span><span class="p">))</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">elements_c</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">elements_c</span><span class="p">)</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">inner</span><span class="p">]</span>
        <span class="c1">#to cartesian</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#cut</span>
        <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">position_shift</span><span class="p">)</span>
        <span class="c1">#back</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span> <span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span></div>

<div class="viewcode-block" id="excess_volume"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.excess_volume">[docs]</a><span class="k">def</span> <span class="nf">excess_volume</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    introduce vacuum between the interfaces</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice_1 : numpy array</span>
<span class="sd">        lattice matrix of the first slab</span>
<span class="sd">    lattice_bi : numpy array</span>
<span class="sd">        lattice matrix of the bicrystal</span>
<span class="sd">    atoms_1, atoms_2 : numpy array</span>
<span class="sd">        atom fractional coordinates of slab 1, slab 2</span>
<span class="sd">    dx : float</span>
<span class="sd">        length of expands normal to the interface with the same units as lattice para</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice_bi, atoms_1, atoms2: numpyarray</span>
<span class="sd">        lattice matrix of bicrystal supercell,</span>
<span class="sd">        atom coordinates of left slab,</span>
<span class="sd">        and atom coordinates of right slab</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">normal_shift</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">ang</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">normal_shift_cart</span> <span class="o">=</span> <span class="n">normal_shift</span> <span class="o">*</span> <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_bi</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">atoms_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">atoms_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">normal_shift_cart</span>
    <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">normal_shift</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">atoms_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">normal_shift</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">atoms_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">),</span> <span class="n">atoms_2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">atoms_2</span></div>

<div class="viewcode-block" id="surface_vacuum"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.surface_vacuum">[docs]</a><span class="k">def</span> <span class="nf">surface_vacuum</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_bi</span><span class="p">,</span> <span class="n">vx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    introduce vacuum at one of the tails of the bicrystal cell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice_1 : numpy array</span>
<span class="sd">        lattice matrix of the first slab</span>
<span class="sd">    lattice_bi : numpy array</span>
<span class="sd">        lattice matrix of the bicrystal</span>
<span class="sd">    atoms_bi : numpy array</span>
<span class="sd">        atom fractional coordinates of the bicrystal</span>
<span class="sd">    vx : float</span>
<span class="sd">        length of the vacuum bulk with units as lattice para</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">normal_shift</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">/</span> <span class="n">ang</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">normal_shift</span><span class="p">)</span>
    <span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">normal_shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="unit_cell_axis"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.unit_cell_axis">[docs]</a><span class="k">def</span> <span class="nf">unit_cell_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get an unit orthogonal cell with the x-axis collinear with certain axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">))</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">get_right_hand</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">B</span></div>

<div class="viewcode-block" id="unit_v"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.unit_v">[docs]</a><span class="k">def</span> <span class="nf">unit_v</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the unit vector of a vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vector</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span></div>

<div class="viewcode-block" id="adjust_orientation"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.adjust_orientation">[docs]</a><span class="k">def</span> <span class="nf">adjust_orientation</span><span class="p">(</span><span class="n">lattice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    adjust the orientation of a lattice so that its first axis is along</span>
<span class="sd">    x-direction and the second axis is in the x-y plane</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        a matrix with column lattice vectors</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice, R: numpy array</span>
<span class="sd">        rotated lattice, rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lattice_0</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="n">v1</span><span class="p">)</span>

    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">unit_v</span><span class="p">(</span><span class="n">v1</span><span class="p">),</span> <span class="n">unit_v</span><span class="p">(</span><span class="n">v2</span><span class="p">),</span> <span class="n">unit_v</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
    <span class="n">this_orientation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">))</span>
    <span class="n">desti_orientation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">desti_orientation</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">this_orientation</span><span class="p">))</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">lattice</span><span class="p">)</span>
    <span class="c1">#check that a1 and a2 points to positive:</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">lattice_0</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">R</span></div>

<div class="viewcode-block" id="convert_vector_index"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.convert_vector_index">[docs]</a><span class="k">def</span> <span class="nf">convert_vector_index</span><span class="p">(</span><span class="n">lattice_0</span><span class="p">,</span> <span class="n">lattice_f</span><span class="p">,</span> <span class="n">v_0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert the index of a vector into a different basis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_0</span><span class="p">,</span> <span class="n">v_0</span><span class="p">)</span>
    <span class="n">v_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice_f</span><span class="p">),</span> <span class="n">v_0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v_f</span></div>

<div class="viewcode-block" id="get_height"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_height">[docs]</a><span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="n">lattice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the distance of the two surfaces (crossing the first vector) of a cell</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">height</span></div>

<div class="viewcode-block" id="get_plane_vectors"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_plane_vectors">[docs]</a><span class="k">def</span> <span class="nf">get_plane_vectors</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a function get the two vectors normal to a vector</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix with column lattice vecotrs</span>
<span class="sd">    n : numpy array</span>
<span class="sd">        a vector</span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    B, indices : numpy array</span>
<span class="sd">        B two plane vectors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-8</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[:,</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;error: the CSL does not include two vectors in the interface&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="n">indices</span></div>

<div class="viewcode-block" id="reciprocal_lattice"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.reciprocal_lattice">[docs]</a><span class="k">def</span> <span class="nf">reciprocal_lattice</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return the reciprocal lattice of B</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">)</span> <span class="o">/</span> <span class="n">V</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="n">v1</span><span class="p">)</span> <span class="o">/</span> <span class="n">V</span>
    <span class="n">b3</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span> <span class="o">/</span> <span class="n">V</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">))</span></div>

<div class="viewcode-block" id="d_hkl"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.d_hkl">[docs]</a><span class="k">def</span> <span class="nf">d_hkl</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">hkl</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return the lattice plane spacing of (hkl) of a lattice</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rep_L</span> <span class="o">=</span> <span class="n">reciprocal_lattice</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rep_L</span><span class="p">,</span> <span class="n">hkl</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="terminates_scanner_left"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.terminates_scanner_left">[docs]</a><span class="k">def</span> <span class="nf">terminates_scanner_left</span><span class="p">(</span><span class="n">slab</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">round_n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    find all different atomic planes</span>
<span class="sd">    within 1 lattice plane displacing (in the interface), for the left slab</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    slab : numpy array</span>
<span class="sd">        basic vectors of the slab</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of atoms</span>
<span class="sd">    elements : list</span>
<span class="sd">        list of name of the atoms</span>
<span class="sd">    d : float</span>
<span class="sd">        1 lattice plane displacing</span>
<span class="sd">    round_n : int</span>
<span class="sd">        num of bits to round the fraction coordinates to judge identical planes</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    plane_list : list</span>
<span class="sd">        list of planes of atom fraction coordinates</span>
<span class="sd">    element_list : list</span>
<span class="sd">        list of elements in each plane</span>
<span class="sd">    indices_list : list</span>
<span class="sd">        list of indices of atoms in each plane</span>
<span class="sd">    dp_list : list</span>
<span class="sd">        list of dp parameters as input to select corresponding termination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plane_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">element_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indices_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dp_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">get_height</span><span class="p">(</span><span class="n">slab</span><span class="p">)</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">slab</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">slab</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
    <span class="n">atoms_cart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">slab</span><span class="p">,</span><span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">projections</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">atoms_cart</span><span class="p">,</span> <span class="n">normal</span><span class="p">))</span>
    <span class="n">atoms_round</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">projections</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span>
    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">atoms_round</span><span class="p">)</span>
    <span class="n">plane_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="o">-</span><span class="n">plane_index</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">position</span> <span class="o">&gt;=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">indices_here</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">atoms_round</span> <span class="o">==</span> <span class="n">x_coords</span><span class="p">[</span><span class="o">-</span><span class="n">plane_index</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dp_here</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">position</span>
        <span class="n">dp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dp_here</span><span class="p">))</span>
        <span class="n">indices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices_here</span><span class="p">)</span>
        <span class="n">plane_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">indices_here</span><span class="p">])</span>
        <span class="n">element_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">indices_here</span><span class="p">])</span>
        <span class="n">plane_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="o">-</span><span class="n">plane_index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">plane_list</span><span class="p">,</span> <span class="n">element_list</span><span class="p">,</span> <span class="n">indices_list</span><span class="p">,</span> <span class="n">dp_list</span></div>

<div class="viewcode-block" id="get_R_to_screen"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_R_to_screen">[docs]</a><span class="k">def</span> <span class="nf">get_R_to_screen</span><span class="p">(</span><span class="n">lattice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get a rotation matrix to make the interface plane of the slab located in the screen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v1</span><span class="p">))</span>
    <span class="n">there</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">there</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">here</span><span class="p">))</span> <span class="c1"># R here = there</span></div>

<div class="viewcode-block" id="terminates_scanner_right"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.terminates_scanner_right">[docs]</a><span class="k">def</span> <span class="nf">terminates_scanner_right</span><span class="p">(</span><span class="n">slab</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">round_n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    find all different atomic planes</span>
<span class="sd">    within 1 lattice plane displacing (in the interface), for the right slab</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    slab : numpy array</span>
<span class="sd">        basic vectors of the slab</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates of atoms</span>
<span class="sd">    elements : list</span>
<span class="sd">        list of name of the atoms</span>
<span class="sd">    d : float</span>
<span class="sd">        1 lattice plane displacing</span>
<span class="sd">    round_n : int</span>
<span class="sd">        num of bits to round the fraction coordinates to judge identical planes</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    plane_list : list</span>
<span class="sd">        list of planes of atom fraction coordinates</span>
<span class="sd">    element_list : list</span>
<span class="sd">        list of elements in each plane</span>
<span class="sd">    indices_list : list</span>
<span class="sd">        list of indices of atoms in each plane</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plane_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">element_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indices_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dp_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">slab</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">slab</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
    <span class="n">atoms_cart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">slab</span><span class="p">,</span><span class="n">atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">projections</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">atoms_cart</span><span class="p">,</span> <span class="n">normal</span><span class="p">))</span>
    <span class="n">atoms_round</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">projections</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span>
    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">atoms_round</span><span class="p">)</span>
    <span class="n">plane_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">indices_here</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">atoms_round</span> <span class="o">==</span> <span class="n">x_coords</span><span class="p">[</span><span class="n">plane_index</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dp_here</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="n">plane_index</span><span class="p">]</span>
        <span class="n">dp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dp_here</span><span class="p">))</span>
        <span class="n">indices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices_here</span><span class="p">)</span>
        <span class="n">plane_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">indices_here</span><span class="p">])</span>
        <span class="n">element_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">indices_here</span><span class="p">])</span>
        <span class="n">plane_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="n">plane_index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">plane_list</span><span class="p">,</span> <span class="n">element_list</span><span class="p">,</span> <span class="n">indices_list</span><span class="p">,</span> <span class="n">dp_list</span></div>

<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># from here functions to draw atomic planes</span>
<span class="c1"># &quot;&quot;&quot;</span>

<div class="viewcode-block" id="draw_cell"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.draw_cell">[docs]</a><span class="k">def</span> <span class="nf">draw_cell</span><span class="p">(</span><span class="n">subfig</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draw the two-dimensional cell</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">subfig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span></div>

<div class="viewcode-block" id="clean_fig"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.clean_fig">[docs]</a><span class="k">def</span> <span class="nf">clean_fig</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="n">num2</span><span class="p">,</span><span class="n">axes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    hide the frames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">facecolor</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Xs_Ys_cell"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.Xs_Ys_cell">[docs]</a><span class="k">def</span> <span class="nf">Xs_Ys_cell</span><span class="p">(</span><span class="n">lattice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the Xs and Ys arrays to draw a cell for a given lattice</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#four verticies</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">P3</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">P4</span> <span class="o">=</span> <span class="n">lattice</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">P3</span> <span class="o">=</span> <span class="p">[</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">P4</span> <span class="o">=</span> <span class="p">[</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="p">[</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">x3</span> <span class="o">=</span> <span class="p">[</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">x4</span> <span class="o">=</span> <span class="p">[</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="p">[</span><span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span></div>

<div class="viewcode-block" id="draw_slab"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.draw_slab">[docs]</a><span class="k">def</span> <span class="nf">draw_slab</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">plane_list</span><span class="p">,</span> <span class="n">lattice_to_screen</span><span class="p">,</span>
              <span class="n">elements_list</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">all_elements</span><span class="p">,</span>
              <span class="n">l_r</span><span class="p">,</span> <span class="n">titlesize</span><span class="p">,</span> <span class="n">legendsize</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draw the terminating planes in the plane list for a slab</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xs, ys : numpy array</span>
<span class="sd">        x,y arrays to draw the two-dimensional cell</span>
<span class="sd">    axes : list</span>
<span class="sd">        list of figures</span>
<span class="sd">    num : int</span>
<span class="sd">        number of terminations</span>
<span class="sd">    plane_list : list</span>
<span class="sd">        list of planes of atoms</span>
<span class="sd">    elements_list : list</span>
<span class="sd">        list of names of elments for these atoms</span>
<span class="sd">    lattice_to_screen : numpy array</span>
<span class="sd">        rotated lattice with the interface lying in the screen</span>
<span class="sd">    l_r : str</span>
<span class="sd">        left or right slab</span>
<span class="sd">    titlesize : int</span>
<span class="sd">        fontsize of title</span>
<span class="sd">    legendsize : int</span>
<span class="sd">        fontsize of legend</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="c1">#get atoms in this plane</span>
        <span class="n">plane_atoms</span> <span class="o">=</span> <span class="n">plane_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">plane_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_to_screen</span><span class="p">,</span> <span class="n">plane_atoms</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#how many different elements in this plane</span>
        <span class="n">plane_elements</span> <span class="o">=</span> <span class="n">elements_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">element_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">plane_elements</span><span class="p">)</span>

        <span class="c1">#looping for different elements</span>
        <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">element_names</span><span class="p">:</span>
            <span class="c1">#get the atoms of j elment</span>
            <span class="n">single_element_atoms</span> <span class="o">=</span> <span class="n">plane_atoms</span><span class="p">[</span>
               <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">plane_elements</span> <span class="o">==</span> <span class="n">en</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="c1">#draw atoms of this element</span>
            <span class="n">Xs</span> <span class="o">=</span> <span class="n">single_element_atoms</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Ys</span> <span class="o">=</span> <span class="n">single_element_atoms</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">element_index_here</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_elements</span> <span class="o">==</span> <span class="n">en</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">draw_cell</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">column</span><span class="p">],</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">element_index_here</span><span class="p">],</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">en</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plane </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">l_r</span><span class="si">}</span><span class="s1"> Cryst.&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">titlesize</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">legendsize</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="write_trans_file"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.write_trans_file">[docs]</a><span class="k">def</span> <span class="nf">write_trans_file</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    write a file including translation information for LAMMPS</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v1, v2 : numpy array</span>
<span class="sd">        CNID vectors</span>
<span class="sd">    n1, n2 : int</span>
<span class="sd">        num of grids for v1 &amp; v2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;paras&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable cnidv1x equal </span><span class="si">{</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">n1</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable cnidv2x equal </span><span class="si">{</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">n2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable cnidv1y equal </span><span class="si">{</span><span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">n1</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable cnidv2y equal </span><span class="si">{</span><span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">n2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable cnidv1z equal </span><span class="si">{</span><span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">n1</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable cnidv2z equal </span><span class="si">{</span><span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">n2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable na equal </span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;variable nb equal </span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="draw_slab_dich"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.draw_slab_dich">[docs]</a><span class="k">def</span> <span class="nf">draw_slab_dich</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">c_xs</span><span class="p">,</span> <span class="n">c_ys</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">num1</span><span class="p">,</span> <span class="n">plane_list_1</span><span class="p">,</span> <span class="n">lattice_to_screen_1</span><span class="p">,</span>
        <span class="n">elements_list_1</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">all_elements</span><span class="p">,</span>
        <span class="n">num2</span><span class="p">,</span> <span class="n">plane_list_2</span><span class="p">,</span> <span class="n">lattice_to_screen_2</span><span class="p">,</span>
        <span class="n">elements_list_2</span><span class="p">,</span> <span class="n">titlesize</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draw the dichromatic patterns</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xs, ys : numpy array</span>
<span class="sd">        x,y arrays to draw the interface cell</span>
<span class="sd">    c_xs, c_ys : numpy array</span>
<span class="sd">        x,y arrays to draw the CNID cell</span>
<span class="sd">    axes : list</span>
<span class="sd">        list of figures</span>
<span class="sd">    num1, num2 : int</span>
<span class="sd">        number of terminations</span>
<span class="sd">    plane_list_1, plane_list_2 : numpy array</span>
<span class="sd">        list of atom coordinates of the terminating planes</span>
<span class="sd">    elements_list_1, elements_list_2 : list</span>
<span class="sd">        list of corresponding element names</span>
<span class="sd">    lattice_to_screen_1, lattice_to_screen_2 : numpy array</span>
<span class="sd">        rotated lattices facing its interface orientation to the screen</span>
<span class="sd">    colors : str</span>
<span class="sd">        colors to classify different elements</span>
<span class="sd">    all_elements : list</span>
<span class="sd">        list of all the elements for all the atoms</span>
<span class="sd">    titlesize : int</span>
<span class="sd">        fontsize of the title</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num2</span><span class="p">):</span>
            <span class="c1">#get atoms in this plane</span>
            <span class="n">plane_atoms_1</span> <span class="o">=</span> <span class="n">plane_list_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">plane_atoms_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_to_screen_1</span><span class="p">,</span> <span class="n">plane_atoms_1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">plane_atoms_2</span> <span class="o">=</span> <span class="n">plane_list_2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">plane_atoms_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_to_screen_2</span><span class="p">,</span> <span class="n">plane_atoms_2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1">#how many different elements in this plane</span>
            <span class="n">plane_elements_1</span> <span class="o">=</span> <span class="n">elements_list_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">element_names_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">plane_elements_1</span><span class="p">)</span>
            <span class="n">plane_elements_2</span> <span class="o">=</span> <span class="n">elements_list_2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">element_names_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">plane_elements_2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">en1</span> <span class="ow">in</span> <span class="n">element_names_1</span><span class="p">:</span>
                <span class="c1">#get the atoms of j elment</span>
                <span class="n">single_element_atoms_1</span> <span class="o">=</span> <span class="n">plane_atoms_1</span><span class="p">[</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">plane_elements_1</span> <span class="o">==</span> <span class="n">en1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

                <span class="c1">#draw atoms of this element</span>
                <span class="n">Xs</span> <span class="o">=</span> <span class="n">single_element_atoms_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ys</span> <span class="o">=</span> <span class="n">single_element_atoms_1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">element_index_here_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_elements</span> <span class="o">==</span> <span class="n">en1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">element_index_here_1</span><span class="p">],</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">en1</span> <span class="o">+</span> <span class="s2">&quot; (L)&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> left </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> right.&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">titlesize</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">en2</span> <span class="ow">in</span> <span class="n">element_names_2</span><span class="p">:</span>
                    <span class="c1">#get the atoms of j elment</span>
                    <span class="n">single_element_atoms_2</span> <span class="o">=</span> <span class="n">plane_atoms_2</span><span class="p">[</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">plane_elements_2</span> <span class="o">==</span> <span class="n">en2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

                    <span class="c1">#draw atoms of this element</span>
                    <span class="n">Xs</span> <span class="o">=</span> <span class="n">single_element_atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">Ys</span> <span class="o">=</span> <span class="n">single_element_atoms_2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">element_index_here_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_elements</span> <span class="o">==</span> <span class="n">en2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">draw_cell</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span>
                    <span class="n">draw_cell</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">c_xs</span><span class="p">,</span><span class="n">c_ys</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                        <span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="n">element_index_here_2</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">en2</span> <span class="o">+</span>  <span class="s2">&quot; (R)&quot;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">num2</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span></div>

<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># Below is some sampling functions</span>
<span class="c1"># &quot;&quot;&quot;</span>

<div class="viewcode-block" id="get_nearest_pair"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_nearest_pair">[docs]</a><span class="k">def</span> <span class="nf">get_nearest_pair</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a function return the indices of two nearest atoms in a periodic block</span>
<span class="sd">    inspired from https://github.com/oekosheri/GB_code</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : numpy array</span>
<span class="sd">        lattice matrix</span>
<span class="sd">    atoms : numpy array</span>
<span class="sd">        fractional coordinates</span>
<span class="sd">    indices : numpy array</span>
<span class="sd">        indices of atoms</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#get Cartesian</span>
    <span class="n">pos_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">pos_2</span> <span class="o">=</span> <span class="n">pos_1</span>
    <span class="c1">#get 9 reps of atoms (PBC)</span>
    <span class="n">reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">x_shifts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_shifts</span> <span class="o">=</span> <span class="n">reps</span>
    <span class="n">z_shifts</span> <span class="o">=</span> <span class="n">reps</span>
    <span class="n">planar_shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
       <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_shifts</span><span class="p">,</span> <span class="n">y_shifts</span><span class="p">,</span> <span class="n">z_shifts</span><span class="p">),</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">planar_shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">planar_shifts</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1">#make images for one set</span>
    <span class="n">n_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">planar_shifts</span><span class="p">)</span>
    <span class="n">n_1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">n_2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">n_1_images</span> <span class="o">=</span> <span class="n">n_images</span> <span class="o">*</span> <span class="n">n_1</span>

    <span class="c1">#repeate to the images</span>
    <span class="n">pos_1_images</span> <span class="o">=</span> <span class="n">pos_1</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">n_images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">planar_shifts</span><span class="p">,</span> <span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pos_1_image_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">n_images</span><span class="p">)</span>

    <span class="c1">#repeat to match num of set 2</span>
    <span class="n">pos_1_rep</span> <span class="o">=</span> <span class="n">pos_1_images</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">n_2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pos_1_index_map</span> <span class="o">=</span> <span class="n">pos_1_image_index_map</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">n_2</span><span class="p">)</span>

    <span class="c1">#repeat to match num of set 1</span>
    <span class="n">pos_2_rep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">pos_2</span><span class="p">,</span> <span class="p">(</span><span class="n">n_1_images</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pos_2_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_2</span><span class="p">),</span> <span class="n">n_1_images</span><span class="p">)</span>

    <span class="c1">#all the distances</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">pos_1_rep</span> <span class="o">-</span> <span class="n">pos_2_rep</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#none zero distances</span>
    <span class="n">distances_none_zero</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">distances</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">distances_none_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">distances_none_zero</span><span class="p">)</span>

    <span class="c1">#not a distance to itself image</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">distances_none_zero</span><span class="p">:</span>
        <span class="n">distances_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">distances</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pos_1_index_map</span><span class="p">[</span><span class="n">distances_id</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pos_2_index_map</span><span class="p">[</span><span class="n">distances_id</span><span class="p">]:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">pos_1_index_map</span><span class="p">[</span><span class="n">distances_id</span><span class="p">]],</span> <span class="n">indices</span><span class="p">[</span><span class="n">pos_2_index_map</span><span class="p">[</span><span class="n">distances_id</span><span class="p">]],</span>
            <span class="n">pos_1_rep</span><span class="p">[</span><span class="n">distances_id</span><span class="p">],</span> <span class="n">pos_2_rep</span><span class="p">[</span><span class="n">distances_id</span><span class="p">])</span></div>


<div class="viewcode-block" id="core"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core">[docs]</a><span class="k">class</span> <span class="nc">core</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Core class for dealing with an interface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_1</span><span class="p">,</span> <span class="n">file_2</span><span class="p">,</span> <span class="n">prim_1</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">prim_2</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_1</span> <span class="o">=</span> <span class="n">file_1</span> <span class="c1"># cif file name of lattice 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_2</span> <span class="o">=</span> <span class="n">file_2</span> <span class="c1"># cif file name of lattice 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_1</span><span class="p">,</span> <span class="n">primitive</span> <span class="o">=</span> <span class="n">prim_1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_2</span><span class="p">,</span> <span class="n">primitive</span> <span class="o">=</span> <span class="n">prim_2</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv_lattice_1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_1</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="p">)</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv_lattice_2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_2</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="p">)</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_1</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># CSL cell in cartesian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># sigma 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># sigma 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># rotation matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span> <span class="c1"># rotation axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># rotation angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># indices of the slab of lattice 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># indices of the slab of lattice 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CNID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span> <span class="o">=</span> <span class="n">DSCcalc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_perp_length</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># initial disorientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#adjusted orientation for better visulaizing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="nb">float</span> <span class="c1">#lattice plane distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="nb">float</span> <span class="c1">#lattice plane distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_list_1</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of terminating plane atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_list_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_1</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of terminating plane atom elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_list_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_list_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_list_1</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#termination plane atoms&#39;s indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices_list_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp_list_1</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of dp parameter to select termination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp_list_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R_see_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span> <span class="c1">#rotate the two slabs so that the screen is crossing the interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_lattice_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#lattice matrix of the final slabs forming the interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_lattice_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1">#get the atoms in the primitive cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_1</span> <span class="o">=</span> <span class="n">get_sites_elements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_2</span> <span class="o">=</span> <span class="n">get_sites_elements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_2</span><span class="p">)</span>
        <span class="c1">#save the information of the bicrystal box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms_bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_bi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_ortho</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#whether the bicrystal supercell is orthogonal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_structure_1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_1</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_structure_2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_1</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
            <span class="n">file_1</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning!, this programme will rewrite the POSCAR file in this dir!&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="core.scale"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor_1</span><span class="p">,</span> <span class="n">factor_2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        scale the lattice 1 and 2 with specific factors</span>
<span class="sd">        (both the lattice and conventional lattice)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factor_1 : float</span>
<span class="sd">            scale factor for lattice 1</span>
<span class="sd">        factor_2 : float</span>
<span class="sd">            scale factor for lattice 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span> <span class="o">*</span> <span class="n">factor_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span> <span class="o">*</span> <span class="n">factor_2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_lattice_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_lattice_1</span> <span class="o">*</span> <span class="n">factor_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_lattice_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_lattice_2</span> <span class="o">*</span> <span class="n">factor_2</span></div>

<div class="viewcode-block" id="core.parse_limit"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.parse_limit">[docs]</a>    <span class="k">def</span> <span class="nf">parse_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">sgm1</span><span class="p">,</span> <span class="n">sgm2</span><span class="p">,</span> <span class="n">dd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set the limitation to accept an appx CSL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        du, S, sgm1, sgm2, dd : parameters</span>
<span class="sd">            see the paper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="n">du</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span> <span class="o">=</span> <span class="n">sgm1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span> <span class="o">=</span> <span class="n">sgm2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd</span> <span class="o">=</span> <span class="n">dd</span></div>

    <span class="k">def</span> <span class="nf">_str_found_csl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">str_found_csl</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;U1 = </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span><span class="si">}</span><span class="s1">; sigma_1 = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sigma1</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;U2 = </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">)</span><span class="si">}</span><span class="s1">; sigma_2 = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;D = </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">str_found_csl</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;axis = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="si">}</span><span class="s1"> ; &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;theta = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">180</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">str_found_csl</span>

    <span class="k">def</span> <span class="nf">_print_found_csl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Congrates, we found an appx CSL!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_str_found_csl</span><span class="p">(</span><span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_found_csl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_str_found_csl</span><span class="p">(</span><span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">))</span>

<div class="viewcode-block" id="core.search_one_position"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.search_one_position">[docs]</a>    <span class="k">def</span> <span class="nf">search_one_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_range</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">two_D</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        main loop finding the appx CSL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axis : numpy array</span>
<span class="sd">            rotation axis</span>
<span class="sd">        theta : float</span>
<span class="sd">            initial rotation angle, in degree</span>
<span class="sd">        theta_range : float</span>
<span class="sd">            range varying theta, in degree</span>
<span class="sd">        dtheta : float</span>
<span class="sd">            step varying theta, in degree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">theta_range</span><span class="o">/</span><span class="n">dtheta</span><span class="p">)</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta_range</span> <span class="o">/</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">two_D</span><span class="p">:</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#find the two primitive plane bases</span>
            <span class="c1">#miller indices</span>
            <span class="n">hkl_1</span> <span class="o">=</span> <span class="n">MID</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
            <span class="n">hkl_2</span> <span class="o">=</span> <span class="n">MID</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">),</span> <span class="n">axis</span><span class="p">)</span>
            <span class="c1">#plane bases</span>
            <span class="n">plane_B_1</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">)</span>
            <span class="n">plane_B_2</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">))</span>
            <span class="n">v_3</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">plane_B_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B_1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">plane_B_1</span><span class="p">,</span> <span class="n">v_3</span><span class="p">))</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">plane_B_2</span><span class="p">,</span> <span class="n">v_3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">a2_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1">#a2_0 back to the initial orientation</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">),</span> <span class="n">a2_0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2_0</span> <span class="o">=</span> <span class="n">a2_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># rotation loop</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.one_position&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---Searching starts---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;axis theta dtheta n S du sigma1_max sigma2_max</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dtheta</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-----------for theta-----------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">rot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">))</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;theta = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -----for N-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">Uij</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">rational_mtx</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
                <span class="n">U_p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">Uij</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">U_p</span><span class="o">-</span><span class="n">U</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">):</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    N= &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; accepted&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">R_p</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">U_p</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">a2_0</span><span class="p">))</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">R</span><span class="p">),</span><span class="n">R_p</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="ow">and</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">)):</span>
                        <span class="n">here_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    --D accepted--</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    D, det(D) = </span><span class="si">{</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">ax2</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a2_0</span><span class="p">)</span>
                        <span class="n">calc</span> <span class="o">=</span> <span class="n">DSCcalc</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">calc</span><span class="o">.</span><span class="n">parse_int_U</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="p">)</span>
                            <span class="n">calc</span><span class="o">.</span><span class="n">compute_CSL</span><span class="p">()</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    failed to find CSL here </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">here_found</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">here_found</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="p">:</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;--------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Congrates, we found an appx CSL!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">sigma1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))))</span>
                            <span class="n">sigma2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U2</span><span class="p">))))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span> <span class="o">=</span> <span class="n">calc</span>
                            <span class="k">if</span> <span class="n">two_D</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">hkl_1</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">),</span> <span class="n">hkl_2</span><span class="p">)</span>
                                <span class="n">calc</span><span class="o">.</span><span class="n">compute_CNID</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">CNID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">CNID</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_write_found_csl</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_print_found_csl</span><span class="p">(</span><span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    sigma too large </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">theta</span> <span class="o">+=</span> <span class="n">dtheta</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;failed to find a satisfying appx CSL. Try to adjust the limits according&#39;</span>
                <span class="s1">&#39;to the log file generated; or try another orientation.&#39;</span><span class="p">)</span></div>

<span class="c1">#    def search_one_position_3D(self, axis, theta, theta_range, dtheta):</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        main loop finding the appx CSL</span>
<span class="c1">#</span>
<span class="c1">#        Parameters</span>
<span class="c1">#        ----------</span>
<span class="c1">#        axis : numpy array</span>
<span class="c1">#            rotation axis</span>
<span class="c1">#        theta : float</span>
<span class="c1">#            initial rotation angle, in degree</span>
<span class="c1">#        theta_range : float</span>
<span class="c1">#            range varying theta, in degree</span>
<span class="c1">#        dtheta : float</span>
<span class="c1">#            step varying theta, in degree</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        axis = np.dot(self.lattice_1, axis)</span>
<span class="c1">#        if self.verbose:</span>
<span class="c1">#            print(axis)</span>
<span class="c1">#        theta = theta / 180 * np.pi</span>
<span class="c1">#        n = np.ceil(theta_range/dtheta)</span>
<span class="c1">#        dtheta = theta_range / n / 180 * np.pi</span>
<span class="c1">#        found = None</span>
<span class="c1">#</span>
<span class="c1">#        a1 = self.lattice_1.copy()</span>
<span class="c1">#        a2_0 = self.lattice_2.copy()</span>
<span class="c1">#</span>
<span class="c1">#        # rotation loop</span>
<span class="c1">#        file = open(&#39;log.one_position&#39;,&#39;w&#39;, encoding=&quot;utf-8&quot;)</span>
<span class="c1">#        file.write(&#39;---Searching starts---\n&#39;)</span>
<span class="c1">#        file.write(&#39;axis theta dtheta n S du sigma1_max sigma2_max\n&#39;)</span>
<span class="c1">#        file.write(f&#39;{axis} {theta} {dtheta} {n} {self.S} {self.du} {self.sgm1} {self.sgm2}\n&#39;)</span>
<span class="c1">#        file.write(&#39;-----------for theta-----------\n&#39;)</span>
<span class="c1">#        for _ in range(int(n)):</span>
<span class="c1">#            N = 1</span>
<span class="c1">#            U = three_dot(inv(a1), R, a2_0)</span>
<span class="c1">#            file.write(&#39;theta = &#39; + str(theta / np.pi * 180) + &#39;\n&#39;)</span>
<span class="c1">#            file.write(&#39;    -----for N-----\n&#39;)</span>
<span class="c1">#            while N &lt;= self.sgm2:</span>
<span class="c1">#                Uij, N = rational_mtx(U,N)</span>
<span class="c1">#                U_p = 1 / N * Uij</span>
<span class="c1">#                if np.all((abs(U_p-U)) &lt; self.du):</span>
<span class="c1">#                    file.write(&#39;    N= &#39; + str(N) + &quot; accepted&quot; + &#39;\n&#39;)</span>
<span class="c1">#                    R_p = three_dot(a1, U_p, inv(a2_0))</span>
<span class="c1">#                    D = np.dot(inv(R),R_p)</span>
<span class="c1">#                    if ((abs(det(D)-1) &lt;= self.S) and</span>
<span class="c1">#                       np.all(abs(D-np.eye(3)) &lt; self.dd)):</span>
<span class="c1">#                        here_found = True</span>
<span class="c1">#                        file.write(&#39;    --D accepted--\n&#39;)</span>
<span class="c1">#                        file.write(f&quot;    D, det(D) = {det(D)} \n&quot;)</span>
<span class="c1">#                        ax2 = three_dot(R,D,a2_0)</span>
<span class="c1">#                        calc = DSCcalc()</span>
<span class="c1">#                        try:</span>
<span class="c1">#                            calc.parse_int_U(a1, ax2, self.sgm2)</span>
<span class="c1">#                            calc.compute_CSL()</span>
<span class="c1">#                        except:</span>
<span class="c1">#                            file.write(&#39;    failed to find CSL here \n&#39;)</span>
<span class="c1">#                            here_found = False</span>
<span class="c1">#                        if here_found and abs(det(calc.U1)) &lt;= self.sgm1:</span>
<span class="c1">#                            found = True</span>
<span class="c1">#                            file.write(&#39;--------------------------------\n&#39;)</span>
<span class="c1">#                            file.write(&#39;Congrates, we found an appx CSL!\n&#39;)</span>
<span class="c1">#                            sigma1 = int(abs(np.round(det(calc.U1))))</span>
<span class="c1">#                            sigma2 = int(abs(np.round(det(calc.U2))))</span>
<span class="c1">#                            self.D = D</span>
<span class="c1">#                            self.U1 = np.array(np.round(calc.U1),dtype = int)</span>
<span class="c1">#                            self.U2 = np.array(np.round(calc.U2),dtype = int)</span>
<span class="c1">#                            self.lattice_2_TD = three_dot(R, D, a2_0)</span>
<span class="c1">#                            self.CSL = np.dot(a1, self.U1)</span>
<span class="c1">#                            self.R = R</span>
<span class="c1">#                            self.theta = theta</span>
<span class="c1">#                            self.axis = axis</span>
<span class="c1">#                            self.cell_calc = calc</span>
<span class="c1">#                            self._write_found_csl(file, sigma1, sigma2, D, axis, theta)</span>
<span class="c1">#                            if self.verbose:</span>
<span class="c1">#                                self._print_found_csl(sigma1, sigma2, D, axis, theta)</span>
<span class="c1">#                            break</span>
<span class="c1">#                        else:</span>
<span class="c1">#                            file.write(&#39;    sigma too large \n&#39;)</span>
<span class="c1">#                N += 1</span>
<span class="c1">#            if found:</span>
<span class="c1">#                break</span>
<span class="c1">#            theta += dtheta</span>
<span class="c1">#        if not found:</span>
<span class="c1">#            print(</span>
<span class="c1">#                &#39;failed to find a satisfying appx CSL. Try to adjust the limits according&#39;</span>
<span class="c1">#                &#39;to the log file generated; or try another orientation.&#39;)</span>

<div class="viewcode-block" id="core.search_fixed"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.search_fixed">[docs]</a>    <span class="k">def</span> <span class="nf">search_fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">exact</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        main loop finding the appx CSL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axis : numpy array</span>
<span class="sd">            rotation axis</span>
<span class="sd">        theta : float</span>
<span class="sd">            initial rotation angle, in degree</span>
<span class="sd">        theta_range : float</span>
<span class="sd">            range varying theta, in degree</span>
<span class="sd">        dtheta : float</span>
<span class="sd">            step varying theta, in degree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">a2_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># rotation loop</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.fixed_search&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---Searching starts---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;axis theta dtheta n S du sigma1_max sigma2_max</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-----------for theta-----------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -----for N-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">Uij</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">rational_mtx</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
            <span class="n">U_p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">Uij</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">U_p</span><span class="o">-</span><span class="n">U</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">):</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;N= &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; accepted&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">R_p</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">U_p</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">a2_0</span><span class="p">))</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">R</span><span class="p">),</span><span class="n">R_p</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(((</span><span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">))):</span>
                    <span class="k">if</span> <span class="n">exact</span><span class="p">:</span>
                        <span class="n">D</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">R</span> <span class="o">=</span> <span class="n">R_p</span>
                    <span class="n">here_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;--D accepted--</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;D, det(D) = </span><span class="si">{</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">ax2</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a2_0</span><span class="p">)</span>
                    <span class="n">calc</span> <span class="o">=</span> <span class="n">DSCcalc</span><span class="p">()</span>
                    <span class="n">calc</span><span class="o">.</span><span class="n">parse_int_U</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
                    <span class="n">calc</span><span class="o">.</span><span class="n">compute_CSL</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">here_found</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="p">:</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;--------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Congrates, we found an appx CSL!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">sigma1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))))</span>
                        <span class="n">sigma2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U2</span><span class="p">))))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span> <span class="o">=</span> <span class="n">calc</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_write_found_csl</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_print_found_csl</span><span class="p">(</span><span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sigma too large </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;failed to find a satisfying appx CSL. &#39;</span>
                <span class="s1">&#39;Try to adjust the limits according &#39;</span>
                <span class="s1">&#39;to the log file generated; or try another orientation.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="core.search_one_position_2D"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.search_one_position_2D">[docs]</a>    <span class="k">def</span> <span class="nf">search_one_position_2D</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hkl_1</span><span class="p">,</span> <span class="n">hkl_2</span><span class="p">,</span> <span class="n">theta_range</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">pre_dt</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pre_R</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">integer_tol</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exact</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        main loop finding the appx CSL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axis : numpy array</span>
<span class="sd">            rotation axis</span>
<span class="sd">        theta : float</span>
<span class="sd">            initial rotation angle, in degree</span>
<span class="sd">        theta_range : float</span>
<span class="sd">            range varying theta, in degree</span>
<span class="sd">        dtheta : float</span>
<span class="sd">            step varying theta, in degree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#get the normal of the two slabs</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">get_normal_from_MI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">hkl_1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">get_normal_from_MI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">hkl_2</span><span class="p">)</span>
        <span class="c1">#get the two plane bases</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">)</span>
        <span class="n">b2_0</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span>
        <span class="c1">#rotate the second crystal so that the two slabs connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_orientation_axis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">),</span><span class="n">n1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">),</span><span class="n">n2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">pre_dt</span><span class="p">:</span>
            <span class="c1">#auxiliary vector</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">pre_R</span>
        <span class="c1">#auxilary vector</span>
        <span class="n">av_1</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">b1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">av_2_0</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">b2_0</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b2_0</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">column_stack</span><span class="p">((</span><span class="n">b1</span><span class="p">,</span><span class="n">av_1</span><span class="p">))</span>
        <span class="n">a2_0</span> <span class="o">=</span> <span class="n">column_stack</span><span class="p">((</span><span class="n">b2_0</span><span class="p">,</span> <span class="n">av_2_0</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">av_2_0</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="p">(</span><span class="n">av_1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">av_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">av_2_0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">b2_0</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">b2_0</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">av_2_0</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">av_2_0</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="p">(</span><span class="n">av_1</span><span class="p">)</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="n">column_stack</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span>
        <span class="c1">#indices of the planal bases</span>
        <span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
        <span class="c1">#starting point of rotation angle</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">start</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="c1">#searching mesh</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">theta_range</span><span class="o">/</span><span class="n">dtheta</span><span class="p">)</span>
        <span class="c1">#shifting angle each time</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta_range</span> <span class="o">/</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">found</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">n1</span>
        <span class="c1"># rotation loop</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.one_position&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---Searching starts---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;axis theta dtheta n S du sigma1_max sigma2_max</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dtheta</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-----------for theta-----------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;theta = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -----for N-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">tol</span> <span class="o">=</span> <span class="n">integer_tol</span>
                <span class="n">Uij</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">rational_mtx</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
                <span class="n">U_p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">Uij</span>
                <span class="n">one_v</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">U_p</span><span class="o">-</span><span class="n">U</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">U_p</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">one_v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">):</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    N= &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; accepted&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">R_p</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">U_p</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">a2_0</span><span class="p">))</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">R</span><span class="p">),</span><span class="n">R_p</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">exact</span><span class="p">:</span>
                        <span class="n">D</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">R</span> <span class="o">=</span> <span class="n">R_p</span>
                    <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="ow">and</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">a2_transform</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
                        <span class="n">here_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    --D accepted--</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    D, det(D) = </span><span class="si">{</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">ax2</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a2_0</span><span class="p">)</span>
                        <span class="n">calc</span> <span class="o">=</span> <span class="n">DSCcalc</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">calc</span><span class="o">.</span><span class="n">parse_int_U</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="p">)</span>
                            <span class="n">calc</span><span class="o">.</span><span class="n">compute_CSL</span><span class="p">()</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    failed to find CSL here </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">here_found</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">here_found</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="p">:</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;--------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Congrates, we found an appx CSL!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                            <span class="n">CSL_here</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span>
                            <span class="n">Pv_1_indices</span> <span class="o">=</span> <span class="n">get_plane_vectors</span><span class="p">(</span><span class="n">CSL_here</span><span class="p">,</span> <span class="n">av_1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">CSL_vs_plane</span> <span class="o">=</span> <span class="n">CSL_here</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">Pv_1_indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">),</span> <span class="n">CSL_vs_plane</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                            <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2_transform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">a2</span><span class="p">),</span> <span class="n">CSL_vs_plane</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
                            <span class="n">sigma1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))))</span>
                            <span class="n">sigma2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span> <span class="o">=</span> <span class="n">calc</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span><span class="o">.</span><span class="n">compute_CNID</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">tol</span><span class="p">)</span>
                            <span class="n">CNID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span><span class="o">.</span><span class="n">CNID</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">CNID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">CNID</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">n1</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_write_found_csl</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_print_found_csl</span><span class="p">(</span><span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    sigma too large </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">theta</span> <span class="o">+=</span> <span class="n">dtheta</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;failed to find a satisfying appx CSL. Try to adjust the limits according&#39;</span>
                <span class="s1">&#39;to the log file generated; or try another orientation.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="core.search_all_position"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.search_all_position">[docs]</a>    <span class="k">def</span> <span class="nf">search_all_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_range</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">two_D</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        main loop finding all the CSL lattices satisfying the limit</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axis : numpy array</span>
<span class="sd">            rotation axis</span>
<span class="sd">        theta : float</span>
<span class="sd">            initial rotation angle, in degree</span>
<span class="sd">        theta_range : list</span>
<span class="sd">            range varying theta, in degree</span>
<span class="sd">        dtheta : float</span>
<span class="sd">            step varying theta, in degree</span>

<span class="sd">        Notes</span>
<span class="sd">        ----------</span>
<span class="sd">        log.all_position :</span>
<span class="sd">            all the searching information</span>
<span class="sd">        results :</span>
<span class="sd">            information of the found approximate CSL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">theta_range</span><span class="o">/</span><span class="n">dtheta</span><span class="p">)</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta_range</span> <span class="o">/</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">two_D</span><span class="p">:</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#find the two primitive plane bases</span>
            <span class="c1">#miller indices</span>
            <span class="n">hkl_1</span> <span class="o">=</span> <span class="n">MID</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">hkl_2</span> <span class="o">=</span> <span class="n">MID</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">),</span> <span class="n">axis</span><span class="p">)</span>
            <span class="c1">#plane bases</span>
            <span class="n">plane_B_1</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">)</span>
            <span class="n">plane_B_2</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">))</span>
            <span class="n">v_3</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">plane_B_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B_1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">plane_B_1</span><span class="p">,</span> <span class="n">v_3</span><span class="p">))</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">plane_B_2</span><span class="p">,</span> <span class="n">v_3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">a2_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1">#a2_0 back to the initial orientation</span>
            <span class="n">a2_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">),</span> <span class="n">a2_0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2_0</span> <span class="o">=</span> <span class="n">a2_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># rotation loop</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.all_position&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">file_r</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---Searching starts---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;axis theta dtheta n S du sigma1_max sigma2_max</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dtheta</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-----------for theta-----------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">rot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">))</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">a2_0</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;theta = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -----for N-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">Uij</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">rational_mtx</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
                <span class="n">U_p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">Uij</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">U_p</span><span class="o">-</span><span class="n">U</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">):</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    N= &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; accepted&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">R_p</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">U_p</span><span class="p">,</span> <span class="n">inv</span><span class="p">(</span><span class="n">a2_0</span><span class="p">))</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">R</span><span class="p">),</span><span class="n">R_p</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">)):</span>
                        <span class="n">here_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    --D accepted--</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    D, det(D) = </span><span class="si">{</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">ax2</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">a2_0</span><span class="p">)</span>
                        <span class="n">calc</span> <span class="o">=</span> <span class="n">DSCcalc</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">calc</span><span class="o">.</span><span class="n">parse_int_U</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm2</span><span class="p">)</span>
                            <span class="n">calc</span><span class="o">.</span><span class="n">compute_CSL</span><span class="p">()</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    failed to find CSL here </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">here_found</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">here_found</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm1</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;--------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">file_r</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;--------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Congrates, we found an appx CSL!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">sigma1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U1</span><span class="p">))))</span>
                            <span class="n">sigma2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">U2</span><span class="p">))))</span>

                            <span class="k">if</span> <span class="n">two_D</span><span class="p">:</span>
                                <span class="n">calc</span><span class="o">.</span><span class="n">compute_CNID</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">CNID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">CNID</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_write_found_csl</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_write_found_csl</span><span class="p">(</span><span class="n">file_r</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">two_D</span><span class="p">:</span>
                                <span class="n">file_r</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CNID = </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CNID</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_print_found_csl</span><span class="p">(</span><span class="n">sigma1</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    sigma too large </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">+=</span> <span class="n">dtheta</span></div>

<div class="viewcode-block" id="core.get_bicrystal"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.get_bicrystal">[docs]</a>    <span class="k">def</span> <span class="nf">get_bicrystal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dydz</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dp1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dp2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">xyz_1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xyz_2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span>
                      <span class="n">two_D</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filetype</span> <span class="o">=</span> <span class="s1">&#39;VASP&#39;</span><span class="p">,</span>  <span class="n">mirror</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">KTI</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate a cif file for the bicrystal structure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dydz : numpy array</span>
<span class="sd">            translation vector in the interface</span>
<span class="sd">        dx : float</span>
<span class="sd">            translation normal to the interface</span>
<span class="sd">        dp1, dp2 : float</span>
<span class="sd">            termination of slab 1, 2</span>
<span class="sd">        xyz1, xyz2 : list</span>
<span class="sd">            expansion of slab 1, 2</span>
<span class="sd">        vx : float</span>
<span class="sd">            vacuum spacing, default 0</span>
<span class="sd">        filename : str</span>
<span class="sd">            filename, default &#39;POSCAR&#39;</span>
<span class="sd">        two_D : bool</span>
<span class="sd">            whether a two CSL</span>
<span class="sd">        filetype : str</span>
<span class="sd">            filetype, &#39;VASP&#39; or &#39;LAMMPS&#39;, default &#39;VASP&#39;</span>
<span class="sd">        mirror : bool</span>
<span class="sd">            mirror, default False</span>
<span class="sd">        KTI : bool</span>
<span class="sd">            KTI, default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dydz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dydz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">xyz_1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xyz_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#get the atoms in the primitive cell</span>
        <span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms_1</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_1</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms_2</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_2</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="c1"># deform &amp; rotate lattice_2</span>
        <span class="k">if</span> <span class="n">two_D</span><span class="p">:</span>
            <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2_transform</span><span class="p">,</span> <span class="n">lattice_2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="n">lattice_2</span><span class="p">)</span>
        <span class="c1">#make supercells of the two slabs</span>
        <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span><span class="p">,</span> <span class="n">lattice_1</span> <span class="o">=</span> <span class="n">super_cell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U1</span><span class="p">,</span>
                                                    <span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mirror</span><span class="p">:</span>
            <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">,</span> <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">super_cell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U2</span><span class="p">,</span>
                                                <span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.000001</span>
            <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">,</span> <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">atoms_1</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">elements_1</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">atoms_c</span><span class="p">,</span> <span class="n">elements_c</span> <span class="o">=</span> <span class="n">atoms_2</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">elements_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">elements_c</span> <span class="o">=</span> <span class="n">elements_c</span><span class="p">[</span><span class="n">atoms_c</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">atoms_c</span> <span class="o">=</span> <span class="n">atoms_c</span><span class="p">[</span><span class="n">atoms_c</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">atoms_c</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms_c</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atoms_2</span><span class="p">,</span> <span class="n">atoms_c</span><span class="p">))</span>
            <span class="n">elements_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements_2</span><span class="p">,</span> <span class="n">elements_c</span><span class="p">)</span>

            <span class="c1"># delete overwrapping atoms</span>
            <span class="n">elements_2</span> <span class="o">=</span> <span class="n">elements_2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">atoms_2</span><span class="p">[</span><span class="n">atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>


        <span class="c1">#expansion</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">xyz_1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">xyz_2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">xyz_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz_1</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="n">xyz_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz_2</span><span class="p">[</span><span class="mi">2</span><span class="p">]]):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;the two slabs must expand &#39;</span>
                    <span class="s1">&#39;to the same dimension in the interface plane&#39;</span><span class="p">)</span>
            <span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span> <span class="o">=</span> <span class="n">cell_expands</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span>
                                                          <span class="n">elements_1</span><span class="p">,</span> <span class="n">xyz_1</span><span class="p">)</span>
            <span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span> <span class="o">=</span> <span class="n">cell_expands</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span>
                                                          <span class="n">elements_2</span><span class="p">,</span> <span class="n">xyz_2</span><span class="p">)</span>

        <span class="c1">#termination</span>
        <span class="k">if</span> <span class="n">dp1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">KTI</span><span class="p">:</span>
                <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span> <span class="o">=</span> <span class="n">shift_termi_left</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">dp1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atoms_1</span> <span class="o">=</span> <span class="n">shift_none_copy</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">dp1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dp2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">KTI</span><span class="p">:</span>
                <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span> <span class="o">=</span> <span class="n">shift_termi_right</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">dp2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">shift_none_copy</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">dp2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">)</span>


        <span class="c1">#adjust the orientation</span>
        <span class="n">lattice_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">=</span> <span class="n">adjust_orientation</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">)</span>
        <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orient</span><span class="p">,</span> <span class="n">lattice_2</span><span class="p">)</span>

        <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span><span class="p">,</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
        <span class="n">POSCAR_to_cif</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span><span class="s1">&#39;cell_1.cif&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_structure_1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">,</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
        <span class="n">POSCAR_to_cif</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span><span class="s1">&#39;cell_2.cif&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_structure_2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">R_see_plane</span> <span class="o">=</span> <span class="n">get_R_to_screen</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plane_list_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_list_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_list_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_list_1</span> \
         <span class="o">=</span> <span class="n">terminates_scanner_left</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">elements_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plane_list_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_list_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_list_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_list_2</span> \
         <span class="o">=</span> <span class="n">terminates_scanner_right</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slab_lattice_1</span> <span class="o">=</span> <span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab_lattice_2</span> <span class="o">=</span> <span class="n">lattice_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1">#combine the two lattices and translate atoms</span>
        <span class="n">lattice_bi</span> <span class="o">=</span> <span class="n">lattice_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">two_D</span><span class="p">:</span>
            <span class="n">height_1</span> <span class="o">=</span> <span class="n">get_height</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">)</span>
            <span class="n">height_2</span> <span class="o">=</span> <span class="n">get_height</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">)</span>
            <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">height_2</span> <span class="o">/</span> <span class="n">height_1</span><span class="p">)</span>
            <span class="c1">#convert to cartesian</span>
            <span class="n">atoms_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">atoms_1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">atoms_2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c1">#translate</span>
            <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">atoms_2</span> <span class="o">+</span> <span class="n">lattice_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#back to the fractional coordinates</span>
            <span class="n">atoms_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">),</span> <span class="n">atoms_1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">),</span> <span class="n">atoms_2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">atoms_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms_1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms_2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1">#excess volume</span>
        <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">excess_volume</span><span class="p">(</span>
                <span class="n">lattice_1</span><span class="p">,</span> <span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_1</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>

        <span class="c1">#in-plane translation</span>
        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">dydz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dydz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orient</span><span class="p">,</span> <span class="n">dydz</span><span class="p">)</span>
            <span class="n">plane_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">),</span> <span class="n">dydz</span><span class="p">)</span>
            <span class="n">atoms_2</span> <span class="o">=</span> <span class="n">atoms_2</span> <span class="o">+</span> <span class="n">plane_shift</span>

        <span class="c1">#combine the two slabs</span>
        <span class="n">elements_bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements_1</span><span class="p">,</span> <span class="n">elements_2</span><span class="p">)</span>
        <span class="n">atoms_bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atoms_1</span><span class="p">,</span> <span class="n">atoms_2</span><span class="p">))</span>

        <span class="c1">#wrap the periodic boundary condition</span>
        <span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atoms_bi</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1">#vacummn</span>
        <span class="k">if</span> <span class="n">vx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">surface_vacuum</span><span class="p">(</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_bi</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>

        <span class="c1">#save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_bi</span> <span class="o">=</span> <span class="n">lattice_bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms_bi</span> <span class="o">=</span> <span class="n">atoms_bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_bi</span> <span class="o">=</span> <span class="n">elements_bi</span>
        <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_bi</span><span class="p">,</span> <span class="n">elements_bi</span><span class="p">,</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;VASP&#39;</span><span class="p">:</span>
            <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_bi</span><span class="p">,</span> <span class="n">elements_bi</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;LAMMPS&#39;</span><span class="p">:</span>
            <span class="n">write_LAMMPS</span><span class="p">(</span><span class="n">lattice_bi</span><span class="p">,</span> <span class="n">atoms_bi</span><span class="p">,</span> <span class="n">elements_bi</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_ortho</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Sorry, we only support for &#39;VASP&#39; or &#39;LAMMPS&#39; output&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="core.sample_CNID"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.sample_CNID">[docs]</a>    <span class="k">def</span> <span class="nf">sample_CNID</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dp1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dp2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">xyz_1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xyz_2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">two_D</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">filetype</span> <span class="o">=</span> <span class="s1">&#39;VASP&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sampling the CNID and generate POSCARs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        grid : numpy array</span>
<span class="sd">            2D grid of sampling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xyz_1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xyz_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;CNID_inputs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CNID&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">CNID</span><span class="p">),</span><span class="mi">8</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;making </span><span class="si">{</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> files...&#39;</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CNID</span><span class="o">.</span><span class="n">T</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span>
                <span class="n">dydz</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">n2</span> <span class="o">*</span> <span class="n">j</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_bicrystal</span><span class="p">(</span>
                    <span class="n">dydz</span> <span class="o">=</span> <span class="n">dydz</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dp1</span> <span class="o">=</span> <span class="n">dp1</span><span class="p">,</span> <span class="n">dp2</span> <span class="o">=</span> <span class="n">dp2</span><span class="p">,</span>
                    <span class="n">xyz_1</span> <span class="o">=</span> <span class="n">xyz_1</span><span class="p">,</span> <span class="n">xyz_2</span> <span class="o">=</span> <span class="n">xyz_2</span><span class="p">,</span> <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span><span class="p">,</span> <span class="n">two_D</span> <span class="o">=</span> <span class="n">two_D</span><span class="p">,</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;CNID_inputs/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">filetype</span> <span class="o">=</span> <span class="n">filetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="core.sample_lattice_planes"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.sample_lattice_planes">[docs]</a>    <span class="k">def</span> <span class="nf">sample_lattice_planes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xyz_1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xyz_2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">two_D</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">filetype</span> <span class="o">=</span> <span class="s1">&#39;VASP&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sampling non-identical lattice planes terminating at the GB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xyz_1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xyz_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;terminating_shift_inputs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;terminating_sampling...&#39;</span><span class="p">)</span>
        <span class="n">position_here</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">position_here</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_perp_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_bicrystal</span><span class="p">(</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dp2</span> <span class="o">=</span> <span class="n">position_here</span><span class="p">,</span>
                <span class="n">xyz_1</span> <span class="o">=</span> <span class="n">xyz_1</span><span class="p">,</span> <span class="n">xyz_2</span> <span class="o">=</span> <span class="n">xyz_2</span><span class="p">,</span> <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span><span class="p">,</span> <span class="n">two_D</span> <span class="o">=</span> <span class="n">two_D</span><span class="p">,</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;terminating_shift_inputs/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">filetype</span> <span class="o">=</span> <span class="n">filetype</span><span class="p">)</span>
            <span class="n">position_here</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d2</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="core.set_orientation_axis"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.set_orientation_axis">[docs]</a>    <span class="k">def</span> <span class="nf">set_orientation_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_1</span><span class="p">,</span> <span class="n">axis_2</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rotate lattice_2 so that its axis_2 coincident with the axis_1 of lattice_1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">axis_1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">axis_1</span> <span class="o">=</span> <span class="n">axis_1</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">axis_1</span><span class="p">)</span>
        <span class="n">axis_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">axis_2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">axis_2</span> <span class="o">=</span> <span class="n">axis_2</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">axis_2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">axis_2</span><span class="p">,</span> <span class="n">axis_1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">axis_1</span><span class="p">,</span> <span class="n">axis_2</span><span class="p">))</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">R</span></div>

<div class="viewcode-block" id="core.compute_bicrystal"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.compute_bicrystal">[docs]</a>    <span class="k">def</span> <span class="nf">compute_bicrystal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hkl</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">normal_ortho</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plane_ortho</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tol_ortho</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="n">tol_integer</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">align_rotation_axis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation_axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inclination_tol</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute the transformation to obtain the supercell of the two slabs forming a interface</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hkl : numpy array</span>
<span class="sd">            miller indices of the plane expressed in lattice_1</span>
<span class="sd">        lim : int</span>
<span class="sd">            the limit searching for a CSL vector cross the plane, default 20</span>
<span class="sd">        normal_ortho : bool</span>
<span class="sd">            whether limit the vector crossing the GB to be normal to the GB, default False</span>
<span class="sd">        plane_ortho : bool</span>
<span class="sd">            whether limit the two vectors in the GB plane to be orthogonal, default False</span>
<span class="sd">        tol_ortho : float</span>
<span class="sd">            tolerance judging whether orthogonal, default 1e-10</span>
<span class="sd">        tol_integer : float</span>
<span class="sd">            tolerance judging integer, default 1e-8</span>
<span class="sd">        align_rotation_axis : bool</span>
<span class="sd">            whether to align to rotation axis, default False</span>
<span class="sd">        rotation_axis : list</span>
<span class="sd">            rotation axis, defalt [1, 1, 1]</span>
<span class="sd">        inclination_tol : float</span>
<span class="sd">            control the angle between the interface and the cross vector, default sqrt(2)/2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rotation_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rotation_axis</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">normal_ortho</span> <span class="ow">and</span> <span class="n">plane_ortho</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_ortho</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">hkl</span><span class="p">)</span>
        <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">three_dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span>
        <span class="n">hkl_2</span> <span class="o">=</span> <span class="n">get_primitive_hkl</span><span class="p">(</span><span class="n">hkl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">lattice_2</span><span class="p">,</span> <span class="n">tol_integer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">hkl_2</span><span class="p">)</span>
        <span class="n">hkl_c</span> <span class="o">=</span> <span class="n">get_primitive_hkl</span><span class="p">(</span>
            <span class="n">hkl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span><span class="p">,</span> <span class="n">tol_integer</span>
            <span class="p">)</span> <span class="c1"># miller indices of the plane in CSL</span>
        <span class="n">hkl_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hkl_c</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hkl in CSL:&#39;</span><span class="p">,</span> <span class="n">hkl_c</span><span class="p">)</span>
        <span class="n">plane_B</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl_c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span><span class="p">)</span> <span class="c1"># plane bases of the CSL lattice plane</span>
        <span class="k">if</span> <span class="n">plane_ortho</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">tol_ortho</span><span class="p">):</span>
            <span class="n">plane_B</span> <span class="o">=</span> <span class="n">get_ortho_two_v</span><span class="p">(</span><span class="n">plane_B</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">tol_ortho</span><span class="p">,</span> <span class="n">align_rotation_axis</span><span class="p">,</span> <span class="n">rotation_axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">align_rotation_axis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">rotation_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">):</span>
                <span class="n">change_v</span> <span class="o">=</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">change_v</span>
        <span class="n">plane_n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># plane normal</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="n">cross_plane</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CSL</span><span class="p">,</span> <span class="n">plane_n</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">normal_ortho</span><span class="p">,</span>
            <span class="n">tol_ortho</span><span class="p">,</span> <span class="n">inclination_tol</span><span class="p">)</span> <span class="c1"># a CSL basic vector cross the plane</span>
        <span class="n">supercell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v3</span><span class="p">,</span> <span class="n">plane_B</span><span class="p">))</span> <span class="c1"># supercell of the bicrystal</span>
        <span class="n">supercell</span> <span class="o">=</span> <span class="n">get_right_hand</span><span class="p">(</span><span class="n">supercell</span><span class="p">)</span> <span class="c1"># check right-handed</span>
        <span class="k">if</span> <span class="n">normal_ortho</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_perp_length</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">),</span> <span class="n">supercell</span><span class="p">),</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_2_TD</span><span class="p">),</span> <span class="n">supercell</span><span class="p">),</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span><span class="o">.</span><span class="n">compute_CNID</span><span class="p">(</span><span class="n">hkl</span><span class="p">,</span><span class="n">tol_integer</span><span class="p">)</span>
        <span class="n">CNID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_calc</span><span class="o">.</span><span class="n">CNID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CNID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">CNID</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cell 1:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U1</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cell 2:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U2</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">))</span></div>

<div class="viewcode-block" id="core.compute_bicrystal_two_D"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.compute_bicrystal_two_D">[docs]</a>    <span class="k">def</span> <span class="nf">compute_bicrystal_two_D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hkl_1</span><span class="p">,</span> <span class="n">hkl_2</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">normal_ortho</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tol_ortho</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="n">tol_integer</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">inclination_tol</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute the transformation</span>
<span class="sd">        to obtain the supercell of the two slabs</span>
<span class="sd">        forming a interface (only two_D periodicity)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hkl1, hkl2 : numpy array</span>
<span class="sd">            miller indices of the plane expressed in lattice_1 and lattice_2</span>
<span class="sd">        lim : int</span>
<span class="sd">            the limit searching for a CSL vector cross the plane, default 20</span>
<span class="sd">        normal_ortho : bool</span>
<span class="sd">            whether limit the vector crossing the GB to be normal to the GB, default False</span>
<span class="sd">        tol_ortho : float</span>
<span class="sd">            tolerance judging whether orthogonal, default 1e-10</span>
<span class="sd">        tol_integer : float</span>
<span class="sd">            tolerance judging integer, default 1e-8</span>
<span class="sd">        inclination_tol : float</span>
<span class="sd">            control the angle between the interface and the cross vector, default sqrt(2)/2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">hkl_1</span><span class="p">)</span>
        <span class="n">lattice_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2_transform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span>
        <span class="n">normal_1</span> <span class="o">=</span> <span class="n">get_normal_from_MI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">hkl_1</span><span class="p">)</span>
        <span class="n">hkl_2</span> <span class="o">=</span> <span class="n">MID</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">normal_1</span><span class="p">,</span> <span class="n">tol_integer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="n">lattice_2</span><span class="p">,</span> <span class="n">hkl_2</span><span class="p">)</span>
        <span class="c1">#the two slabs with auxilary vector</span>
        <span class="n">plane_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span>

        <span class="c1">#the transformed lattice_2</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2_transform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_2</span><span class="p">)</span>
        <span class="n">plane_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">)</span>

        <span class="n">v3_1</span> <span class="o">=</span> <span class="n">cross_plane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">,</span> <span class="n">normal_1</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">normal_ortho</span><span class="p">,</span> <span class="n">tol_ortho</span><span class="p">,</span> <span class="n">inclination_tol</span><span class="p">)</span>
        <span class="n">v3_2</span> <span class="o">=</span> <span class="n">cross_plane</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">normal_1</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">normal_ortho</span><span class="p">,</span> <span class="n">tol_ortho</span><span class="p">,</span> <span class="n">inclination_tol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v3_1</span><span class="p">,</span> <span class="n">v3_2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v3_2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">v3_2</span>

        <span class="c1">#unit slabs</span>
        <span class="n">cell_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v3_1</span><span class="p">,</span> <span class="n">plane_1</span><span class="p">))</span>
        <span class="n">cell_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v3_2</span><span class="p">,</span> <span class="n">plane_2</span><span class="p">))</span>

        <span class="c1">#right_handed</span>
        <span class="n">cell_1</span> <span class="o">=</span> <span class="n">get_right_hand</span><span class="p">(</span><span class="n">cell_1</span><span class="p">)</span>
        <span class="n">cell_2</span> <span class="o">=</span> <span class="n">get_right_hand</span><span class="p">(</span><span class="n">cell_2</span><span class="p">)</span>

        <span class="c1">#supercell index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_1</span><span class="p">),</span> <span class="n">cell_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">a2</span><span class="p">),</span> <span class="n">cell_2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cell 1:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U1</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cell 2:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bicrystal_U2</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">))</span></div>

<div class="viewcode-block" id="core.define_lammps_regions"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.core.define_lammps_regions">[docs]</a>    <span class="k">def</span> <span class="nf">define_lammps_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_names</span><span class="p">,</span> <span class="n">region_los</span><span class="p">,</span> <span class="n">region_his</span><span class="p">,</span> <span class="n">ortho</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate a file defining some regions in the LAMMPS and define the atoms</span>
<span class="sd">        inside these regions into some groups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        region_names : list</span>
<span class="sd">            list of name of regions</span>
<span class="sd">        region_los : list</span>
<span class="sd">            list of the low bounds</span>
<span class="sd">        region_his : list</span>
<span class="sd">            list of the hi bounds</span>
<span class="sd">        ortho : bool</span>
<span class="sd">            whether the cell is orthogonal</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">region_los</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_names</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">region_los</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_his</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;the region_names, low &amp; high bounds must have same num of elements.&quot;</span><span class="p">)</span>

        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_bi</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;blockfile&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fb</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rn</span><span class="p">,</span> <span class="n">rl</span><span class="p">,</span> <span class="n">rh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">region_names</span><span class="p">,</span> <span class="n">region_los</span><span class="p">,</span> <span class="n">region_his</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ortho</span><span class="p">:</span>
                    <span class="n">fb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;region </span><span class="si">{</span><span class="n">rn</span><span class="si">}</span><span class="s1"> prism </span><span class="si">{</span><span class="n">rl</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">rh</span><span class="si">}</span><span class="s1"> EDGE EDGE EDGE EDGE &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xy</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xz</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">yz</span><span class="si">}</span><span class="s1"> units box </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;region </span><span class="si">{</span><span class="n">rn</span><span class="si">}</span><span class="s1"> block </span><span class="si">{</span><span class="n">rl</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">rh</span><span class="si">}</span><span class="s1"> EDGE EDGE EDGE EDGE &#39;</span>
                        <span class="s1">&#39;units box </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;group </span><span class="si">{</span><span class="n">rn</span><span class="si">}</span><span class="s1"> region </span><span class="si">{</span><span class="n">rn</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="terminates_scanner_slab_structure"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.terminates_scanner_slab_structure">[docs]</a><span class="k">def</span> <span class="nf">terminates_scanner_slab_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">hkl</span><span class="p">):</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">get_sites_elements</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span>
    <span class="n">plane_B</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl</span><span class="p">,</span> <span class="n">lattice</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d_hkl</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">hkl</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">cross_plane</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">cross</span><span class="p">(</span><span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
    <span class="n">supercell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v3</span><span class="p">,</span> <span class="n">plane_B</span><span class="p">))</span> <span class="c1"># supercell of the bicrystal</span>
    <span class="n">supercell</span> <span class="o">=</span> <span class="n">get_right_hand</span><span class="p">(</span><span class="n">supercell</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span> <span class="n">supercell</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cross vector: </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="n">U</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">length: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">v3</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;plane basis: </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">U</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;length: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">supercell</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">supercell</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">lattice</span> <span class="o">=</span> <span class="n">super_cell</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
    <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="s1">&#39;POSCAR_primitive&#39;</span><span class="p">)</span>
    <span class="n">lattice</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">adjust_orientation</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
    <span class="n">plane_list</span><span class="p">,</span> <span class="n">element_list</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dp_list</span> <span class="o">=</span> <span class="n">terminates_scanner_left</span><span class="p">(</span>
        <span class="n">supercell</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">round_n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plane_list</span><span class="p">,</span> <span class="n">element_list</span><span class="p">,</span> <span class="n">dp_list</span></div>

<div class="viewcode-block" id="get_surface_slab"><a class="viewcode-back" href="../../interfacemaster.html#interfacemaster.interface_generator.get_surface_slab">[docs]</a><span class="k">def</span> <span class="nf">get_surface_slab</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">hkl</span><span class="p">,</span> <span class="n">replica</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inclination_tol</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">termi_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vacuum_height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">plane_normal</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">normal_perp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">normal_tol</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">filetype</span> <span class="o">=</span> <span class="s1">&#39;VASP&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get a superlattice of a slab containing a desired surface as crystal plane hkl</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    structure : Structure object</span>
<span class="sd">        Structure object of the unit cell structure</span>
<span class="sd">    hkl : numpy array</span>
<span class="sd">        miller indices of the surface plane</span>
<span class="sd">    replica : list</span>
<span class="sd">        expansion of the primitive slab cell, default [1, 1, 1]</span>
<span class="sd">    inclination_tol : float</span>
<span class="sd">        required minimum cos value of the angle</span>
<span class="sd">        between the basic crossing vector and the surface, default sqrt(2)/2</span>
<span class="sd">    termi_shift : float</span>
<span class="sd">        shift the termination of the surface, default 0</span>
<span class="sd">    vacuum_height : float</span>
<span class="sd">        height of vaccum</span>
<span class="sd">    plane_normal : bool</span>
<span class="sd">        whether requiring the two vectors</span>
<span class="sd">        in the surface plane to be perpendicular, default False</span>
<span class="sd">    normal_perp : bool</span>
<span class="sd">        whether requiring the crossing vector to be perpendicular to the plane, default False</span>
<span class="sd">    normal_tol :</span>
<span class="sd">        tolerance to judge whether perpendicular, default 1e-3</span>
<span class="sd">    lim : int</span>
<span class="sd">        control the number of generated vectors</span>
<span class="sd">        to search for the crossing vectors and perpendicular vectors, default 20</span>
<span class="sd">    filename : str</span>
<span class="sd">        name of the generated atom files</span>
<span class="sd">    filetype : str, &quot;VASP&quot; or &quot;LAMMPS&quot;</span>
<span class="sd">        type of the generated atom files (for VASP or LAMMPS)</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">        slab_structure : structure object</span>
<span class="sd">            slab structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">replica</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">replica</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">get_sites_elements</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">T</span>
    <span class="n">plane_B</span> <span class="o">=</span> <span class="n">get_pri_vec_inplane</span><span class="p">(</span><span class="n">hkl</span><span class="p">,</span> <span class="n">lattice</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plane_normal</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">normal_tol</span><span class="p">):</span>
        <span class="n">plane_B</span> <span class="o">=</span> <span class="n">get_ortho_two_v</span><span class="p">(</span><span class="n">plane_B</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">normal_tol</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">cross_plane</span><span class="p">(</span>
        <span class="n">lattice</span><span class="p">,</span> <span class="n">cross</span><span class="p">(</span><span class="n">plane_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">plane_B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">lim</span><span class="p">,</span> <span class="n">normal_perp</span><span class="p">,</span> <span class="n">normal_tol</span><span class="p">,</span> <span class="n">inclination_tol</span><span class="p">)</span>
    <span class="n">supercell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">v3</span><span class="p">,</span> <span class="n">plane_B</span><span class="p">))</span> <span class="c1"># supercell of the bicrystal</span>
    <span class="n">supercell</span> <span class="o">=</span> <span class="n">get_right_hand</span><span class="p">(</span><span class="n">supercell</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span> <span class="n">supercell</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cross vector: </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="n">U</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">length: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">v3</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;plane basis: </span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">U</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;length: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">supercell</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">supercell</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">lattice</span> <span class="o">=</span> <span class="n">super_cell</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
    <span class="n">lattice</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">adjust_orientation</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">replica</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">cell_expands</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">replica</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">termi_shift</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">shift_none_copy</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">termi_shift</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">vacuum_height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">surface_vacuum</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">vacuum_height</span><span class="p">)</span>

    <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
    <span class="n">slab_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merge_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;VASP&#39;</span><span class="p">:</span>
        <span class="n">write_POSCAR</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;LAMMPS&#39;</span><span class="p">:</span>
        <span class="n">orthogonal</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plane_normal</span> <span class="ow">and</span> <span class="n">normal_perp</span><span class="p">:</span>
            <span class="n">orthogonal</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">write_LAMMPS</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">orthogonal</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Sorry, we only support for &#39;VASP&#39; or &#39;LAMMPS&#39; output&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">slab_structure</span></div>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2023, Y. Xie, K. Shibata, T. Mizoguchi.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 6.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a>
  0.13.0rc4dev0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>